(()=>{"use strict";var e,t,n={88:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(l,r){function a(e){try{d(o.next(e))}catch(e){r(e)}}function i(e){try{d(o.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?l(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}d((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const l=n(557);let r=[];const a=new AudioContext,i=a.createGain();i.connect(a.destination);let d=null,u=null,c=0,m=0,p=document.getElementById("file"),s=document.getElementById("loading");p.onchange=()=>o(void 0,void 0,void 0,(function*(){var e;s.innerHTML="loading...",p.disabled=!0;try{if(!p.files)return;let t=p.files[0],n=yield t.arrayBuffer();const o=yield(0,l.loadMusicMetadata)(),i=yield o.parseWebStream(yield t.stream());if(null==i||null==i.native||null==i.format||null==i.format.sampleRate)return void alert("failed to read audio data.");let d=null,u=null,c=null;if(null!=i.native.vorbis){const e=i.native.vorbis.find((e=>"LOOPSTART"===e.id.toUpperCase())),t=i.native.vorbis.find((e=>"LOOPLENGTH"===e.id.toUpperCase())),n=i.native.vorbis.find((e=>"LOOPEND"===e.id.toUpperCase()));void 0!==e&&(d=Number(e.value)),void 0!==t&&(u=Number(t.value)),void 0!==n&&(c=Number(n.value)),null==c&&null!=d&&null!=u&&(c=d+u),null==u&&null!=d&&null!=c&&(u=c-d)}let s=yield a.decodeAudioData(n);const f={file:t,metadata:i,loopStart:d,loopLength:u,loopEnd:c,title:i.common.title?i.common.title:t.name,artist:i.common.artist,arrayBuffer:s,id:m++};void 0===f.metadata.format.numberOfSamples&&(f.metadata.format.numberOfSamples=Math.ceil(f.metadata.format.duration*f.metadata.format.sampleRate)),r.push(f);let h=document.createElement("tr");{let e=document.createElement("td"),t=document.createElement("input");t.type="radio",t.name="selected",t.value=String(f.id),e.appendChild(t),h.appendChild(e)}{let e=document.createElement("td");e.innerText=f.title,h.appendChild(e)}{let e=document.createElement("td");e.innerText=b(f.metadata.format.duration),h.appendChild(e)}{let e=document.createElement("td");e.innerText=f.loopStart&&f.loopEnd?"Loop":"",h.appendChild(e)}{let t=document.createElement("td");t.innerText=null!==(e=f.artist)&&void 0!==e?e:"",h.appendChild(t)}{let e=document.createElement("td"),t=document.createElement("button");t.innerText="Remove",t.name="Remove",t.value=String(f.id),t.addEventListener("click",E),e.appendChild(t),h.appendChild(e)}document.getElementById("tbody").appendChild(h)}finally{p.disabled=!1,s.innerHTML=""}})),document.getElementById("button-play").onclick=()=>{let e=-1,t=document.getElementsByName("selected");for(let n=0;n<t.length;n++)if(t.item(n).checked){e=Number(t.item(n).value);break}if(-1===e)return void alert("not selected");if(u=r.find((t=>t.id==e)),!u)return void alert("file not found");if(v(),g(0),!d)return void alert("internal error (source is undefined)");"suspended"===a.state&&a.resume();let n=document.getElementById("sound-title");n&&(n.innerHTML="Title:"+u.title+(u.artist?" / "+u.artist:""));let o=document.getElementById("sound-loop-range");o&&(o.innerHTML="LoopRange:"+b(d.loopStart)+"-"+b(d.loopEnd))},document.getElementById("button-pause").onclick=()=>{"suspended"===a.state?a.resume():a.suspend()},document.getElementById("button-stop").onclick=()=>{v()};let f=document.getElementById("range-volume");f.oninput=()=>{i.gain.value=Number(f.value)};let h=document.getElementById("seekbar");function g(e){u&&(d=a.createBufferSource(),d.connect(i),d.buffer=u.arrayBuffer,d.start(0,e),c=a.currentTime-e,d.loop=!0,null!==u.loopStart&&null!==u.loopEnd&&(d.loopStart=u.loopStart/u.metadata.format.sampleRate,d.loopEnd=u.loopEnd/u.metadata.format.sampleRate,e>=d.loopEnd&&(d.loop=!1)))}function v(){d&&(d.stop(0),d.disconnect(),d=null)}function b(e){let t=Math.floor(e/3600),n=Math.floor(e/60%60),o=Math.floor(e%60),l=Math.floor(100*e)%100;return("0"+t).slice(-2)+":"+("0"+n).slice(-2)+":"+("0"+o).slice(-2)+"."+("0"+l).slice(-2)}function y(){if(!u||!d)return 0;let e=a.currentTime-c;if(null!==u.loopStart&&null!==u.loopEnd&&null!==u.loopLength&&!0===d.loop){let t=u.loopEnd/u.metadata.format.sampleRate;for(;e>t;)e-=u.loopLength/u.metadata.format.sampleRate}else if(!0===d.loop){let t=u.metadata.format.duration;for(;e>t;)e-=t}else e=Math.min(e,u.metadata.format.duration);return e}function E(e){r=r.filter((t=>t.id!=Number(e.target.value)));const t=document.getElementById("tbody");for(let n=0;n<t.children.length;n++)if(t.children[n].children[0].children[0].value==e.target.value){t.deleteRow(n);break}}h.onmouseup=e=>{if(!d||!u)return;const t=h,n=e.target.getBoundingClientRect(),o=(Math.max(Math.min(e.clientX-n.left,t.width-5),5)-5)/(t.width-10)*u.metadata.format.duration;v(),g(o)},setInterval((function(){const e=document.getElementById("seekbar"),t=e.getContext("2d");if(t&&(t.clearRect(0,0,e.width,e.height),t.fillStyle="rgb(230, 230, 230)",t.fillRect(0,0,e.width,e.height),t.fillStyle="rgb(255, 255, 255)",t.fillRect(5,5,e.width-10,e.height-10),d&&u)){null!==u.loopStart&&null!==u.loopEnd&&null!==u.loopLength&&(t.fillStyle="rgb(54, 132, 228)",t.fillRect((e.width-10)*(u.loopStart/u.metadata.format.numberOfSamples)+5,5,(e.width-10)*(u.loopLength/u.metadata.format.numberOfSamples),e.height-10));let n=y()/u.metadata.format.duration*(e.width-10);t.fillStyle="rgb(0, 0, 0)",t.fillRect(n,0,10,e.height),t.fillStyle="rgb(255, 255, 255)",t.fillRect(n+1,1,8,e.height-2)}}),50),setInterval((function(){if(d){const e=document.getElementById("sound-current-time");e&&(e.innerHTML="CurrentTime:"+b(y()))}}),100)},557:(e,t,n)=>{e.exports={loadMusicMetadata:()=>n.e(237).then(n.bind(n,237))}}},o={};function l(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return n[e].call(r.exports,r,r.exports,l),r.exports}l.m=n,l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,n)=>(l.f[n](e,t),t)),[])),l.u=e=>e+".app.min.js",l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="loopmusicplayer-web:",l.l=(n,o,r,a)=>{if(e[n])e[n].push(o);else{var i,d;if(void 0!==r)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var m=u[c];if(m.getAttribute("src")==n||m.getAttribute("data-webpack")==t+r){i=m;break}}i||(d=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,l.nc&&i.setAttribute("nonce",l.nc),i.setAttribute("data-webpack",t+r),i.src=n),e[n]=[o];var p=(t,o)=>{i.onerror=i.onload=null,clearTimeout(s);var l=e[n];if(delete e[n],i.parentNode&&i.parentNode.removeChild(i),l&&l.forEach((e=>e(o))),t)return t(o)},s=setTimeout(p.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=p.bind(null,i.onerror),i.onload=p.bind(null,i.onload),d&&document.head.appendChild(i)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;l.g.importScripts&&(e=l.g.location+"");var t=l.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=e})(),(()=>{var e={792:0};l.f.j=(t,n)=>{var o=l.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var r=new Promise(((n,l)=>o=e[t]=[n,l]));n.push(o[2]=r);var a=l.p+l.u(t),i=new Error;l.l(a,(n=>{if(l.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var r=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;i.message="Loading chunk "+t+" failed.\n("+r+": "+a+")",i.name="ChunkLoadError",i.type=r,i.request=a,o[1](i)}}),"chunk-"+t,t)}};var t=(t,n)=>{var o,r,[a,i,d]=n,u=0;if(a.some((t=>0!==e[t]))){for(o in i)l.o(i,o)&&(l.m[o]=i[o]);d&&d(l)}for(t&&t(n);u<a.length;u++)r=a[u],l.o(e,r)&&e[r]&&e[r][0](),e[r]=0},n=self.webpackChunkloopmusicplayer_web=self.webpackChunkloopmusicplayer_web||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),l(88)})();