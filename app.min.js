(()=>{"use strict";var e,t,n={88:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,l){function a(e){try{d(o.next(e))}catch(e){l(e)}}function i(e){try{d(o.throw(e))}catch(e){l(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}d((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=l(n(557));let d=[];const u=new AudioContext,c=u.createGain();c.connect(u.destination);let m=null,s=null,f=0,p=0,h=document.getElementById("file"),g=document.getElementById("loading");h.onchange=()=>a(void 0,void 0,void 0,(function*(){var e;g.innerHTML="loading...",h.disabled=!0;try{if(!h.files)return;let t=h.files[0],n=yield t.arrayBuffer();const o=yield i.parseWebStream(yield t.stream());if(null==o||null==o.native||null==o.format||null==o.format.sampleRate)return void alert("failed to read audio data.");let r=null,l=null,a=null;if(null!=o.native.vorbis){const e=o.native.vorbis.find((e=>"LOOPSTART"===e.id.toUpperCase())),t=o.native.vorbis.find((e=>"LOOPLENGTH"===e.id.toUpperCase())),n=o.native.vorbis.find((e=>"LOOPEND"===e.id.toUpperCase()));void 0!==e&&(r=Number(e.value)),void 0!==t&&(l=Number(t.value)),void 0!==n&&(a=Number(n.value)),null==a&&null!=r&&null!=l&&(a=r+l),null==l&&null!=r&&null!=a&&(l=a-r)}let c=yield u.decodeAudioData(n);const m={file:t,metadata:o,loopStart:r,loopLength:l,loopEnd:a,title:o.common.title?o.common.title:t.name,artist:o.common.artist,arrayBuffer:c,id:p++};void 0===m.metadata.format.numberOfSamples&&(m.metadata.format.numberOfSamples=Math.ceil(m.metadata.format.duration*m.metadata.format.sampleRate)),d.push(m);let s=document.createElement("tr");{let e=document.createElement("td"),t=document.createElement("input");t.type="radio",t.name="selected",t.value=String(m.id),e.appendChild(t),s.appendChild(e)}{let e=document.createElement("td");e.innerText=m.title,s.appendChild(e)}{let e=document.createElement("td");e.innerText=w(m.metadata.format.duration),s.appendChild(e)}{let e=document.createElement("td");e.innerText=m.loopStart&&m.loopEnd?"Loop":"",s.appendChild(e)}{let t=document.createElement("td");t.innerText=null!==(e=m.artist)&&void 0!==e?e:"",s.appendChild(t)}{let e=document.createElement("td"),t=document.createElement("button");t.innerText="Remove",t.name="Remove",t.value=String(m.id),t.addEventListener("click",T),e.appendChild(t),s.appendChild(e)}document.getElementById("tbody").appendChild(s)}finally{h.disabled=!1,g.innerHTML=""}})),document.getElementById("button-play").onclick=()=>{let e=-1,t=document.getElementsByName("selected");for(let n=0;n<t.length;n++)if(t.item(n).checked){e=Number(t.item(n).value);break}if(-1===e)return void alert("not selected");if(s=d.find((t=>t.id==e)),!s)return void alert("file not found");if(E(),y(0),!m)return void alert("internal error (source is undefined)");"suspended"===u.state&&u.resume();let n=document.getElementById("sound-title");n&&(n.innerHTML="Title:"+s.title+(s.artist?" / "+s.artist:""));let o=document.getElementById("sound-loop-range");o&&(o.innerHTML="LoopRange:"+w(m.loopStart)+"-"+w(m.loopEnd))},document.getElementById("button-pause").onclick=()=>{"suspended"===u.state?u.resume():u.suspend()},document.getElementById("button-stop").onclick=()=>{E()};let b=document.getElementById("range-volume");b.oninput=()=>{c.gain.value=Number(b.value)};let v=document.getElementById("seekbar");function y(e){s&&(m=u.createBufferSource(),m.connect(c),m.buffer=s.arrayBuffer,m.start(0,e),f=u.currentTime-e,m.loop=!0,null!==s.loopStart&&null!==s.loopEnd&&(m.loopStart=s.loopStart/s.metadata.format.sampleRate,m.loopEnd=s.loopEnd/s.metadata.format.sampleRate,e>=m.loopEnd&&(m.loop=!1)))}function E(){m&&(m.stop(0),m.disconnect(),m=null)}function w(e){let t=Math.floor(e/3600),n=Math.floor(e/60%60),o=Math.floor(e%60),r=Math.floor(100*e)%100;return("0"+t).slice(-2)+":"+("0"+n).slice(-2)+":"+("0"+o).slice(-2)+"."+("0"+r).slice(-2)}function S(){if(!s||!m)return 0;let e=u.currentTime-f;if(null!==s.loopStart&&null!==s.loopEnd&&null!==s.loopLength&&!0===m.loop){let t=s.loopEnd/s.metadata.format.sampleRate;for(;e>t;)e-=s.loopLength/s.metadata.format.sampleRate}else if(!0===m.loop){let t=s.metadata.format.duration;for(;e>t;)e-=t}else e=Math.min(e,s.metadata.format.duration);return e}function T(e){d=d.filter((t=>t.id!=Number(e.target.value)));const t=document.getElementById("tbody");for(let n=0;n<t.children.length;n++)if(t.children[n].children[0].children[0].value==e.target.value){t.deleteRow(n);break}}v.onmouseup=e=>{if(!m||!s)return;const t=v,n=e.target.getBoundingClientRect(),o=(Math.max(Math.min(e.clientX-n.left,t.width-5),5)-5)/(t.width-10)*s.metadata.format.duration;E(),y(o)},setInterval((function(){const e=document.getElementById("seekbar"),t=e.getContext("2d");if(t&&(t.clearRect(0,0,e.width,e.height),t.fillStyle="rgb(230, 230, 230)",t.fillRect(0,0,e.width,e.height),t.fillStyle="rgb(255, 255, 255)",t.fillRect(5,5,e.width-10,e.height-10),m&&s)){null!==s.loopStart&&null!==s.loopEnd&&null!==s.loopLength&&(t.fillStyle="rgb(54, 132, 228)",t.fillRect((e.width-10)*(s.loopStart/s.metadata.format.numberOfSamples)+5,5,(e.width-10)*(s.loopLength/s.metadata.format.numberOfSamples),e.height-10));let n=S()/s.metadata.format.duration*(e.width-10);t.fillStyle="rgb(0, 0, 0)",t.fillRect(n,0,10,e.height),t.fillStyle="rgb(255, 255, 255)",t.fillRect(n+1,1,8,e.height-2)}}),50),setInterval((function(){if(m){const e=document.getElementById("sound-current-time");e&&(e.innerHTML="CurrentTime:"+w(S()))}}),100)},557:(e,t,n)=>{e.exports={loadMusicMetadata:()=>n.e(353).then(n.bind(n,353))}}},o={};function r(e){var t=o[e];if(void 0!==t)return t.exports;var l=o[e]={exports:{}};return n[e].call(l.exports,l,l.exports,r),l.exports}r.m=n,r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,n)=>(r.f[n](e,t),t)),[])),r.u=e=>e+".app.min.js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="loopmusicplayer-web:",r.l=(n,o,l,a)=>{if(e[n])e[n].push(o);else{var i,d;if(void 0!==l)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var m=u[c];if(m.getAttribute("src")==n||m.getAttribute("data-webpack")==t+l){i=m;break}}i||(d=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,r.nc&&i.setAttribute("nonce",r.nc),i.setAttribute("data-webpack",t+l),i.src=n),e[n]=[o];var s=(t,o)=>{i.onerror=i.onload=null,clearTimeout(f);var r=e[n];if(delete e[n],i.parentNode&&i.parentNode.removeChild(i),r&&r.forEach((e=>e(o))),t)return t(o)},f=setTimeout(s.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=s.bind(null,i.onerror),i.onload=s.bind(null,i.onload),d&&document.head.appendChild(i)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={792:0};r.f.j=(t,n)=>{var o=r.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var l=new Promise(((n,r)=>o=e[t]=[n,r]));n.push(o[2]=l);var a=r.p+r.u(t),i=new Error;r.l(a,(n=>{if(r.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var l=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;i.message="Loading chunk "+t+" failed.\n("+l+": "+a+")",i.name="ChunkLoadError",i.type=l,i.request=a,o[1](i)}}),"chunk-"+t,t)}};var t=(t,n)=>{var o,l,[a,i,d]=n,u=0;if(a.some((t=>0!==e[t]))){for(o in i)r.o(i,o)&&(r.m[o]=i[o]);d&&d(r)}for(t&&t(n);u<a.length;u++)l=a[u],r.o(e,l)&&e[l]&&e[l][0](),e[l]=0},n=self.webpackChunkloopmusicplayer_web=self.webpackChunkloopmusicplayer_web||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),r(88)})();